{"datasets":[{"name":"98e32fe3","displayName":"1.Total_MRR","query":"-- 1. Total MRR \n-- Create a counter visualisation\n\nSELECT\n  sum(amount)/1000 as MRR\nFROM main.odl_user_1423373_databrickslabs_com_retail.churn_orders\nWHERE\n    month(to_timestamp(transaction_date, 'MM-dd-yyyy HH:mm:ss')) = \n  (\n    select max(month(to_timestamp(transaction_date, 'MM-dd-yyyy HH:mm:ss')))\n      from main.odl_user_1423373_databrickslabs_com_retail.churn_orders\n  );\n\n"},{"name":"75976438","displayName":"2.MRR_at_risk","query":"-- 2.MRR at risk \n-- Create a counter visualisation\n\nSELECT\n    sum(amount)/1000 as MRR_at_risk\nFROM main.odl_user_1423373_databrickslabs_com_retail.churn_orders\nWHERE month(to_timestamp(transaction_date, 'MM-dd-yyyy HH:mm:ss')) = \n    (\n        select max(month(to_timestamp(transaction_date, 'MM-dd-yyyy HH:mm:ss')))\n        from main.odl_user_1423373_databrickslabs_com_retail.churn_orders\n    )\n    and user_id in\n    (\n        SELECT user_id FROM main.odl_user_1423373_databrickslabs_com_retail.churn_prediction WHERE churn_prediction=1\n    )\n\n"},{"name":"754785a3","displayName":"3.Customers_at_Risk","query":"\n-- 3. Customer at Risk\nSELECT count(*) as Customers, cast(churn_prediction as boolean) as `At Risk`\nFROM main.odl_user_1423373_databrickslabs_com_retail.churn_prediction GROUP BY churn_prediction;\n\n\n"},{"name":"f7f42554","displayName":"5.Subscriptions_by_Internet_Service-Historical","query":"-- For 4 and 5 switch to the schema where the DLT tables are created\n-- 5. Subscriptions by Internet Service - Historical\n-- Create a horizontal bar visualisation\nselect platform, churn, count(*) as event_count\nfrom main.odl_user_1423373_databrickslabs_com_retail.churn_app_events\ninner join main.odl_user_1423373_databrickslabs_com_retail.churn_users using (user_id)\nwhere platform is not null\ngroup by platform, churn\n"},{"name":"1dffcfd9","displayName":"6.Predicted_to_churn_by_channel","query":"-- 6. Predicted to churn by channel\n-- Create a pie chart visualisation\n\nSELECT channel, count(*) as users\nFROM main.odl_user_1423373_databrickslabs_com_retail.churn_prediction\nWHERE churn_prediction=1 and channel is not null\nGROUP BY channel\n"},{"name":"55dfa87c","displayName":"7.Predicted_to_churn_by_country","query":"-- 7. Predicted to churn by country\n-- Create a bar visualisation\n\nSELECT country, churn_prediction, count(*) as customers\nFROM main.odl_user_1423373_databrickslabs_com_retail.churn_prediction\nGROUP BY country, churn_prediction\n"}],"pages":[{"name":"19a16472","displayName":"New Page","layout":[{"widget":{"name":"d3c4f957","queries":[{"name":"1d8416949a834de6b5dd23a742973abe","query":{"datasetName":"98e32fe3","disaggregated":true}}],"spec":{"version":0,"viz_spec":{"display_name":"Total MRR - 1.Total_MRR","description":"","viz_type":"COUNTER","serialized_options":"{\"counterLabel\":\"Total MRR \",\"counterColName\":\"MRR\",\"rowNumber\":1,\"targetRowNumber\":1,\"stringDecimal\":0,\"stringDecChar\":\".\",\"stringThouSep\":\",\",\"tooltipFormat\":\"0,0.000\",\"condensed\":true,\"withRowNumber\":true}","query_name":"1d8416949a834de6b5dd23a742973abe"}}},"position":{"x":0,"y":0,"width":2,"height":4}},{"widget":{"name":"d9cc0773","queries":[{"name":"f1cf8cef99a542cf93d98d5441f0f84b","query":{"datasetName":"f7f42554","fields":[{"name":"churn","expression":"`churn`"},{"name":"column_3f43fdbe3259","expression":"SUM(`event_count`)"},{"name":"platform","expression":"`platform`"}],"disaggregated":false}}],"spec":{"version":0,"viz_spec":{"display_name":"Subscriptions by Internet Service - Historical - 5.Subscriptions_by_Internet_Service-Historical","description":"","viz_type":"CHART","serialized_options":"{\"version\":2,\"globalSeriesType\":\"column\",\"sortX\":true,\"sortY\":true,\"legend\":{\"traceorder\":\"normal\"},\"xAxis\":{\"type\":\"-\",\"labels\":{\"enabled\":true}},\"yAxis\":[{\"type\":\"-\"},{\"type\":\"-\",\"opposite\":true}],\"alignYAxesAtZero\":true,\"error_y\":{\"type\":\"data\",\"visible\":true},\"series\":{\"stacking\":null,\"error_y\":{\"type\":\"data\",\"visible\":true}},\"seriesOptions\":{\"column_3f43fdbe3259\":{\"name\":\"event_count\",\"yAxis\":0,\"type\":\"column\"}},\"valuesOptions\":{},\"direction\":{\"type\":\"counterclockwise\"},\"sizemode\":\"diameter\",\"coefficient\":1,\"numberFormat\":\"0,0.[00000]\",\"percentFormat\":\"0[.]00%\",\"textFormat\":\"\",\"missingValuesAsZero\":true,\"useAggregationsUi\":true,\"swappedAxes\":true,\"dateTimeFormat\":\"DD/MM/YY HH:mm:ss\",\"showDataLabels\":false,\"columnConfigurationMap\":{\"x\":{\"column\":\"churn\",\"id\":\"column_3f43fdbe3258\"},\"y\":[{\"column\":\"event_count\",\"id\":\"column_3f43fdbe3259\",\"transform\":\"SUM\"}],\"series\":{\"column\":\"platform\",\"id\":\"column_3f43fdbe3260\"}},\"isAggregationOn\":true,\"condensed\":true,\"withRowNumber\":true}","query_name":"f1cf8cef99a542cf93d98d5441f0f84b"}}},"position":{"x":0,"y":7,"width":2,"height":7}},{"widget":{"name":"8ea1a775","queries":[{"name":"f59792e232a6478599292aad4a0d4f31","query":{"datasetName":"1dffcfd9","fields":[{"name":"channel","expression":"`channel`"},{"name":"column_3f43fdbe3693","expression":"SUM(`users`)"}],"disaggregated":false}}],"spec":{"version":0,"viz_spec":{"display_name":"Predicted to churn by channel - 6.Predicted_to_churn_by_channel","description":"","viz_type":"CHART","serialized_options":"{\"version\":2,\"globalSeriesType\":\"pie\",\"sortX\":true,\"sortY\":true,\"legend\":{\"traceorder\":\"normal\"},\"xAxis\":{\"type\":\"-\",\"labels\":{\"enabled\":true}},\"yAxis\":[{\"type\":\"-\"},{\"type\":\"-\",\"opposite\":true}],\"alignYAxesAtZero\":true,\"error_y\":{\"type\":\"data\",\"visible\":true},\"series\":{\"stacking\":null,\"error_y\":{\"type\":\"data\",\"visible\":true}},\"seriesOptions\":{\"column_3f43fdbe3693\":{\"name\":\"users\",\"yAxis\":0,\"type\":\"pie\"}},\"valuesOptions\":{},\"direction\":{\"type\":\"counterclockwise\"},\"sizemode\":\"diameter\",\"coefficient\":1,\"numberFormat\":\"0,0.[00000]\",\"percentFormat\":\"0[.]00%\",\"textFormat\":\"\",\"missingValuesAsZero\":true,\"useAggregationsUi\":true,\"swappedAxes\":false,\"dateTimeFormat\":\"DD/MM/YY HH:mm:ss\",\"showDataLabels\":true,\"columnConfigurationMap\":{\"x\":{\"column\":\"channel\",\"id\":\"column_3f43fdbe3692\"},\"y\":[{\"column\":\"users\",\"transform\":\"SUM\",\"id\":\"column_3f43fdbe3693\"}]}}","query_name":"f59792e232a6478599292aad4a0d4f31"}}},"position":{"x":2,"y":7,"width":2,"height":7}},{"widget":{"name":"7933241d","queries":[{"name":"eb3f00b25953434ab9b799d806af38d4","query":{"datasetName":"754785a3","fields":[{"name":"At Risk","expression":"`At Risk`"},{"name":"column_3f43fdbe1925","expression":"SUM(`Customers`)"}],"disaggregated":false}}],"spec":{"version":0,"viz_spec":{"display_name":"Customer at Risk - 3.Customers_at_Risk","description":"","viz_type":"CHART","serialized_options":"{\"version\":2,\"globalSeriesType\":\"column\",\"sortX\":true,\"sortY\":true,\"legend\":{\"traceorder\":\"normal\"},\"xAxis\":{\"type\":\"-\",\"labels\":{\"enabled\":true}},\"yAxis\":[{\"type\":\"-\"},{\"type\":\"-\",\"opposite\":true}],\"alignYAxesAtZero\":true,\"error_y\":{\"type\":\"data\",\"visible\":true},\"series\":{\"stacking\":null,\"error_y\":{\"type\":\"data\",\"visible\":true}},\"seriesOptions\":{\"column_3f43fdbe1925\":{\"name\":\"Customers\",\"yAxis\":0}},\"valuesOptions\":{},\"direction\":{\"type\":\"counterclockwise\"},\"sizemode\":\"diameter\",\"coefficient\":1,\"numberFormat\":\"0,0.[00000]\",\"percentFormat\":\"0[.]00%\",\"textFormat\":\"\",\"missingValuesAsZero\":true,\"useAggregationsUi\":true,\"swappedAxes\":true,\"dateTimeFormat\":\"DD/MM/YY HH:mm:ss\",\"showDataLabels\":false,\"columnConfigurationMap\":{\"x\":{\"column\":\"At Risk\",\"id\":\"column_3f43fdbe1924\"},\"y\":[{\"column\":\"Customers\",\"transform\":\"SUM\",\"id\":\"column_3f43fdbe1925\"}]}}","query_name":"eb3f00b25953434ab9b799d806af38d4"}}},"position":{"x":2,"y":0,"width":2,"height":7}},{"widget":{"name":"308823b5","queries":[{"name":"c644bd871f3c4f22ade6227c3d78a10f","query":{"datasetName":"75976438","disaggregated":true}}],"spec":{"version":0,"viz_spec":{"display_name":"MRR at risk - 2.MRR_at_risk","description":"","viz_type":"COUNTER","serialized_options":"{\"counterLabel\":\"MRR at risk \",\"counterColName\":\"MRR_at_risk\",\"rowNumber\":1,\"targetRowNumber\":1,\"stringDecimal\":0,\"stringDecChar\":\".\",\"stringThouSep\":\",\",\"tooltipFormat\":\"0,0.000\"}","query_name":"c644bd871f3c4f22ade6227c3d78a10f"}}},"position":{"x":0,"y":4,"width":2,"height":3}},{"widget":{"name":"e3ce7576","queries":[{"name":"8c14c45849904a81adec1dceb7a2d170","query":{"datasetName":"55dfa87c","fields":[{"name":"churn_prediction","expression":"`churn_prediction`"},{"name":"column_3f43fdbe3982","expression":"SUM(`customers`)"},{"name":"country","expression":"`country`"}],"disaggregated":false}}],"spec":{"version":0,"viz_spec":{"display_name":"Predicted to churn by country - 7.Predicted_to_churn_by_country","description":"","viz_type":"CHART","serialized_options":"{\"version\":2,\"globalSeriesType\":\"column\",\"sortX\":true,\"sortY\":true,\"legend\":{\"traceorder\":\"normal\"},\"xAxis\":{\"type\":\"-\",\"labels\":{\"enabled\":true}},\"yAxis\":[{\"type\":\"-\"},{\"type\":\"-\",\"opposite\":true}],\"alignYAxesAtZero\":true,\"error_y\":{\"type\":\"data\",\"visible\":true},\"series\":{\"stacking\":null,\"error_y\":{\"type\":\"data\",\"visible\":true}},\"seriesOptions\":{\"column_3f43fdbe3982\":{\"name\":\"customers\",\"yAxis\":0,\"type\":\"column\"}},\"valuesOptions\":{},\"direction\":{\"type\":\"counterclockwise\"},\"sizemode\":\"diameter\",\"coefficient\":1,\"numberFormat\":\"0,0.[00000]\",\"percentFormat\":\"0[.]00%\",\"textFormat\":\"\",\"missingValuesAsZero\":true,\"useAggregationsUi\":true,\"swappedAxes\":false,\"dateTimeFormat\":\"DD/MM/YY HH:mm:ss\",\"showDataLabels\":false,\"columnConfigurationMap\":{\"x\":{\"column\":\"churn_prediction\",\"id\":\"column_3f43fdbe3981\"},\"y\":[{\"column\":\"customers\",\"id\":\"column_3f43fdbe3982\",\"transform\":\"SUM\"}],\"series\":{\"column\":\"country\",\"id\":\"column_3f43fdbe3983\"}},\"isAggregationOn\":true}","query_name":"8c14c45849904a81adec1dceb7a2d170"}}},"position":{"x":0,"y":14,"width":4,"height":6}},{"widget":{"name":"77c21594","queries":[{"name":"main_query","query":{"datasetName":"1dffcfd9","fields":[{"name":"channel","expression":"`channel`"},{"name":"users","expression":"`users`"}],"disaggregated":true}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"channel","scale":{"type":"categorical","sort":{"by":"y-reversed"}},"displayName":"channel"},"y":{"fieldName":"users","scale":{"type":"quantitative"},"displayName":"users"}},"frame":{"title":"Predicted Churn by Channel","showTitle":true}}},"position":{"x":0,"y":20,"width":3,"height":6}},{"widget":{"name":"a0bfc7a7","queries":[{"name":"main_query","query":{"datasetName":"f7f42554","fields":[{"name":"platform","expression":"`platform`"},{"name":"churn","expression":"`churn`"},{"name":"event_count","expression":"`event_count`"}],"disaggregated":true}}],"spec":{"version":1,"widgetType":"table","encodings":{"columns":[{"fieldName":"platform","title":"platform","booleanValues":["false","true"],"type":"string","displayAs":"string","displayName":"platform"},{"fieldName":"churn","title":"churn","booleanValues":["false","true"],"type":"integer","displayAs":"number","displayName":"churn"},{"fieldName":"event_count","title":"event_count","booleanValues":["false","true"],"type":"integer","displayAs":"number","displayName":"event_count"}]},"invisibleColumns":[],"allowHTMLByDefault":false,"itemsPerPage":25,"paginationSize":"default","condensed":true,"withRowNumber":false,"frame":{"title":"Table of Subscriptions by Internet Service","showTitle":true}}},"position":{"x":3,"y":20,"width":3,"height":6}}]}]}